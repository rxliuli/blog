---
layout: post
title: Browser Extension Dev - 如何找到锁定滚动的元素
abbrlink: b67661fa00b344c29c3cda7359b0d138
tags:
  - chrome extension
  - javascript
categories:
  - 前端
  - Browser Extension
date: 1767703447035
updated: 1767718233027
---

## 背景

最近因为多邻国 app 的 bug，我正在考虑切换到 web 版本。但没想到移动端 web 版本及其恶心，每次打开首页都会弹出 app 下载推广，这真的太烦人了。我第一时间就想去写个 UserScript 彻底删除它，但没想到还碰到一些有趣的问题。

![1767703519864.jpg](/resources/73d0ba372f134a8f9ec08b15c5dac364.jpg)

## 分析

从 Devtools > Element 中很容易就找到了弹窗元素的稳定选择器。

```js
#overlays:has([href*="adj.st"])
```

页面遮罩也很容易定位。

```js
[data-test="drawer-backdrop"]
```

然后我就可以正常点击了，但我仍然无法自由滚动，而滚动条锁定又不在 html/body 上，所以这种情况下应该如何找到是哪个 HTML 元素导致的滚动条锁定呢？

![1767713512009.jpg](/resources/a68f8645383e4232a408d68a53ad8992.jpg)

## 解决

想要解决这个问题需要一些简单的启发式的方法。首先，一般如何实现滚动条锁定？
通常只需要给 body 元素增加一些样式即可，例如

```css
body {
  overflow: hidden;
}
```

或者使用 `position: fixed`

```ts
document.body.style.position = 'fixed'
document.body.style.top = `-${scrollPosition}px`
document.body.style.width = '100%'
```

按照这种思路，我们可以找到一个在无法滚动区域内的元素，然后递归向上查找，直到找到 `overflow: hidden;` 或者 `position: fixed` 的元素即可认为它就是阻止滚动的罪魁祸首，实现起来相当简单。

```ts
function findScrollBlocker(element) {
  let current = element
  while (current && current !== document.body) {
    const style = getComputedStyle(current)
    if (style.overflow === 'hidden' || style.position === 'fixed') {
      return current
    }
    current = current.parentElement
  }
}

findScrollBlocker($0)
```

视频演示

<iframe width="560" height="315" src="https://www.youtube.com/embed/G9zZKkC2M1Q?si=-oUcFf3zXQX6B4wP" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

现在，我们可以通过 css 恢复正常的滚动条了。

> tip: `$0` 在 Devtools > Console 中代表在 Devtools > Elements 面板中选中的元素。

## 总结

如果你也想尝试开发 Extension 或者 UserScript 来改善你的 Web 体验，不妨一试，JavaScript 提供了相当多 trick 的技巧，如果只是编写普通的 Web App，可能永远不会有机会尝试。
